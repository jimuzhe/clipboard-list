<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Favicon è·å–æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }

        .test-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .favicon {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .url {
            font-family: monospace;
            color: #666;
        }

        .test-btn {
            padding: 8px 16px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .loading {
            color: #666;
            font-style: italic;
        }
    </style>
</head>

<body>
    <h1>ğŸ”— Favicon è·å–åŠŸèƒ½æµ‹è¯•</h1>
    <p>æµ‹è¯•è‡ªåŠ¨è·å–ç½‘ç«™å›¾æ ‡åŠŸèƒ½</p>

    <button class="test-btn" onclick="testAllFavicons()">å¼€å§‹æµ‹è¯•</button>

    <div id="test-results"></div>

    <script>
        // æµ‹è¯•ç”¨çš„ç½‘ç«™åˆ—è¡¨
        const testUrls = [
            'https://github.com',
            'https://stackoverflow.com',
            'https://chat.openai.com',
            'https://translate.google.com',
            'https://www.douban.com',
            'https://www.bing.com',
            'https://zh.wikipedia.org',
            'https://codepen.io',
            'https://www.youtube.com',
            'https://www.bilibili.com'
        ];
        async function getFaviconForUrl(url) {
            try {
                // ä½¿ç”¨xxapi.cnçš„APIæ¥å£
                const apiUrl = `https://v2.xxapi.cn/api/ico?url=${encodeURIComponent(url)}`;

                console.log('ğŸ” æ­£åœ¨è·å–ç½‘ç«™å›¾æ ‡:', url);

                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                    }
                });

                if (!response.ok) {
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                }

                const data = await response.json();

                // æ£€æŸ¥APIè¿”å›çš„æ•°æ®ç»“æ„
                if (data && data.code === 200 && data.data) {
                    console.log('âœ… æˆåŠŸè·å–ç½‘ç«™å›¾æ ‡:', data.data);
                    return data.data;
                } else if (data && data.ico) {
                    console.log('âœ… æˆåŠŸè·å–ç½‘ç«™å›¾æ ‡:', data.ico);
                    return data.ico;
                } else {
                    throw new Error('APIè¿”å›æ ¼å¼ä¸æ­£ç¡®: ' + JSON.stringify(data));
                }
            } catch (error) {
                console.warn('âŒ è·å–faviconå¤±è´¥:', error.message);

                // å¦‚æœAPIå¤±è´¥ï¼Œå›é€€åˆ°å¤‡ç”¨æ–¹æ¡ˆ
                try {
                    const urlObj = new URL(url);
                    const domain = urlObj.hostname;
                    const fallbackUrl = `https://www.google.com/s2/favicons?domain=${domain}&sz=32`;
                    console.log('ğŸ”„ ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ:', fallbackUrl);
                    return fallbackUrl;
                } catch (fallbackError) {
                    console.warn('âŒ å¤‡ç”¨æ–¹æ¡ˆä¹Ÿå¤±è´¥äº†:', fallbackError.message);
                    return null;
                }
            }
        }

        async function testAllFavicons() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<div class="loading">æ­£åœ¨æµ‹è¯•è·å–ç½‘ç«™å›¾æ ‡...</div>';

            const results = [];

            for (const url of testUrls) {
                try {
                    const faviconUrl = await getFaviconForUrl(url);
                    results.push({
                        url,
                        faviconUrl,
                        success: !!faviconUrl
                    });
                } catch (error) {
                    results.push({
                        url,
                        faviconUrl: null,
                        success: false,
                        error: error.message
                    });
                }
            }

            // æ˜¾ç¤ºç»“æœ
            let html = '<h2>æµ‹è¯•ç»“æœ</h2>';
            results.forEach(result => {
                html += `
                    <div class="test-item">
                        ${result.success ? 
                            `<img class="favicon" src="${result.faviconUrl}" alt="favicon" onerror="this.src='data:image/svg+xml,<svg xmlns=\\"http://www.w3.org/2000/svg\\" viewBox=\\"0 0 24 24\\"><circle cx=\\"12\\" cy=\\"12\\" r=\\"10\\" fill=\\"none\\" stroke=\\"currentColor\\" stroke-width=\\"2\\"/></svg>'" />` :
                            '<div class="favicon" style="background: #ddd; display: flex; align-items: center; justify-content: center;">âŒ</div>'
                        }
                        <div>
                            <div><strong>${new URL(result.url).hostname}</strong></div>
                            <div class="url">${result.url}</div>
                            ${result.success ? 
                                `<div style="color: green;">âœ… æˆåŠŸè·å–å›¾æ ‡</div>` :
                                `<div style="color: red;">âŒ è·å–å¤±è´¥: ${result.error || 'æœªçŸ¥é”™è¯¯'}</div>`
                            }
                        </div>
                    </div>
                `;
            });

            resultsDiv.innerHTML = html;
        }
    </script>
</body>

</html>